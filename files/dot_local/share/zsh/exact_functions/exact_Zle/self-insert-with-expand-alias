# vim: set ft=zsh:

case $WIDGET in
  insert-a-with-expand-alias)
    case $BUFFER in
      'git add -')
        BUFFER="git add -A"
        CURSOR=${#BUFFER}
        ;;

      *)
        zle .self-insert
        ;;
    esac
    ;;

  insert-space-with-expand-alias|magic-space)
    case $BUFFER in
      ck)
        BUFFER="git checkout "
        CURSOR=${#BUFFER}
        ;;

      'git checkout -b')
        local reply="git checkout -b $(git config --local user.name)/$(git rev-parse --abbrev-ref HEAD)/"
        BUFFER="${reply} && git commit --allow-empty -m ':new: Create topic branch'"
        CURSOR=${#reply}
        ;;

      b)
        BUFFER="git branch "
        CURSOR=${#BUFFER}
        ;;

      'git branch -m')
        BUFFER="git branch -m $(git rev-parse --abbrev-ref HEAD)"
        CURSOR=${#BUFFER}
        ;;

      'git branch -d')
        BUFFER="git branch -D "
        CURSOR=${#BUFFER}
        zle fzf-completion-or-expand-or-complete
        ;;

      a)
        BUFFER="git add "
        CURSOR=${#BUFFER}
        ;;

      'git add ')
        zle fzf-completion-or-expand-or-complete
        ;;

      c)
        BUFFER="git commit "
        CURSOR=${#BUFFER}
        ;;

      'git commit -m')
        zle .self-insert
        zle fzf-completion-or-expand-or-complete
        ;;

      'git commit --fixup')
        zle .self-insert
        zle fzf-completion-or-expand-or-complete
        ;;

      r)
        BUFFER="git rebase "
        CURSOR=${#BUFFER}
        ;;

      'git rebase -i')
        zle .self-insert
        zle fzf-completion-or-expand-or-complete
        ;;

      git\ push\ (-f|--force))
        BUFFER="git push --force-with-lease --force-if-includes "
        CURSOR=${#BUFFER}
        ;;

      d)
        BUFFER="docker "
        CURSOR=${#BUFFER}
        ;;

      dr)
        BUFFER="docker run --rm -it "
        CURSOR=${#BUFFER}
        ;;

      dc)
        BUFFER="docker compose "
        CURSOR=${#BUFFER}
        ;;

      nr)
        BUFFER="npm run "
        CURSOR=${#BUFFER}
        ;;

      *)
        zle _expand_alias
        zle .self-insert
        ;;
    esac
    ;;

  *)
    zle .self-insert
    ;;
esac

zle .reset-prompt

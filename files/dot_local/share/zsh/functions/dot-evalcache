local EVALCACHE_DIR=~/.cache/zsh/evalcache
mkdir -p $EVALCACHE_DIR

local -A opthash
zparseopts -D -A opthash -- c: -command:=c

local key
if [[ -n "${opthash[(i)-c]}" ]]; then
  key=${opthash[-c]}
else
  key=$1
fi

if [ -z "${commands[$key]}" ]; then
  return
fi

local cache=$EVALCACHE_DIR/${key}.zsh
if [ -f $cache ]; then
  source $cache
  return
fi

"$@" > $cache
zcompile $cache
source $cache

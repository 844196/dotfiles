autoload -Uz \
  select-word-style \
  smart-insert-last-word \
  dot-compinit \
  dot-widgetinit \
  dot-send-osc7 \
  dot-evalcache

# core
setopt no_flow_control
setopt print_eight_bit
precmd_functions+=(dot-send-osc7)
zstyle ':dot:evalcache:*' cache-dir ~/.cache/zsh/evalcache

# colors
dot-evalcache ~/.local/libexec/vivid-compat iceberg-dark

# aliases
alias ..='cd ..'
alias t='cd "$(mktemp -d)"'
alias st='git status'
alias ck='git checkout'
alias br='git branch -vv'
alias co='git commit'
alias di='git -c delta.side-by-side=true diff'
alias gg='git graph -n 15'
alias c='chezmoi'
alias m='multipass'
alias ls='exa -gF --icons --git --color=always -la'
alias grep='rg'
alias find='fd'
alias top='btm'
alias htop='btm'
alias df='duf'
alias du='dust'
alias ping='gping'
alias d='docker'
alias dc='docker compose'
alias nr='npm run'

# word-chars
select-word-style default
zstyle ':zle:*' word-chars " /=;@:{},|"
zstyle ':zle:*' word-style unspecified

# completions
setopt nolistbeep
setopt magic_equal_subst
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS} # Must be after execution of vivid-compat (i.e. LS_COLORS loaded)
zstyle ':completion:*' matcher-list '' 'm:{a-z}={A-Z} r:|[-_.]=**' '+m:{A-Z}={a-z} r:|[-_.]=**'
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.cache/zsh/compcache
zstyle ':dot:compinit:*' dump-path ~/.cache/zsh/compdump
zstyle ':dot:compinit:*' dump-ttl $((60 * 60 * 24 * 7))
zstyle ':dot:compinit:*' compile-dump yes

# histories
HISTFILE=~/.local/state/zsh/history
HISTSIZE=1000000
SAVEHIST=1000000
setopt extendedhistory
setopt share_history
setopt hist_reduce_blanks
setopt hist_find_no_dups

# keybindings
dot-widgetinit
zle -N insert-last-word smart-insert-last-word
zstyle ':insert-last-word' match '*([[:alpha:]/\\]?|?[[:alpha:]/\\])*'
bindkey '^N' history-search-forward
bindkey '^P' history-search-backward
bindkey '^[[Z' reverse-menu-complete
bindkey '^M' dot-expand-alias-and-accept-line
bindkey ' ' dot-expand-alias-and-self-insert
bindkey '^R' dot-put-history
bindkey '^X^B' dot-insert-git-branch
bindkey '^X^F' dot-insert-git-file
bindkey '^X^G' dot-cd-ghq
bindkey '^X^J' dot-cd-zoxide

# plugins
dot-evalcache sheldon source

# setup cli tools
zsh-defer source ~/.config/fzf/config.sh
zsh-defer dot-evalcache navi widget zsh
zsh-defer dot-evalcache zoxide init zsh --no-cmd
zsh-defer dot-evalcache direnv hook zsh

# prompt
setopt transient_rprompt
dot-evalcache starship init zsh --print-full-init # Must be execution at end of zshrc

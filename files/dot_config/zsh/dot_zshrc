autoload -Uz add-zsh-hook
autoload -Uz select-word-style
autoload -Uz history-search-end
autoload -Uz smart-insert-last-word
autoload -Uz dot-widgetinit
autoload -Uz dot-historyignore
autoload -Uz dot-send-osc7
autoload -Uz dot-evalcache
autoload -Uz dot-toggle-delta-features
autoload -Uz pbcopy pbpaste
autoload -Uz promptinit
autoload -Uz accept-line-with-expand-alias self-insert-with-expand-alias

# hooks
add-zsh-hook precmd dot-send-osc7
add-zsh-hook preexec dot-toggle-delta-features
add-zsh-hook zshaddhistory dot-historyignore

# core
unsetopt FLOW_CONTROL
setopt PRINT_EIGHT_BIT
zstyle ':dot:evalcache:*' cache-dir ~/.cache/zsh/evalcache

# colors
dot-evalcache ~/.local/libexec/vivid-compat iceberg-dark

# aliases
alias ..='cd ..'
alias t='cd "$(mktemp -d)"'
alias st=' git status'
alias ck='git checkout'
alias br='git branch -vv'
alias co='git commit'
alias di=' git diff'
alias gg=' git graph -n 15'
alias c='chezmoi'
alias ls=' exa -gF --icons --git --color=always -la'
alias d='docker'
alias dc='docker compose'
alias nr='npm run'
alias -g C='| pbcopy'

# word-chars
select-word-style default
zstyle ':zle:*' word-chars " /=;@:{},|"
zstyle ':zle:*' word-style unspecified

# completions
unsetopt LIST_BEEP
setopt MAGIC_EQUAL_SUBST
zstyle ':completion:*' menu select=2
zstyle ':completion:*' verbose yes
zstyle ':completion:*' list-packed yes
zstyle ':completion:*' list-separator 'â”‚'
zstyle ':completion:*' list-colors 'no=0;38;5;8:ma=0;38;5;0;48;5;8:fi=0;38;5;7:di=0;38;5;4:ex=0;38;5;1'
zstyle ':completion:*' matcher-list '' 'm:{a-z}={A-Z} r:|[-_.]=**' '+m:{A-Z}={a-z} r:|[-_.]=**'
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.cache/zsh/compcache

# histories
HISTFILE=~/.local/state/zsh/history
HISTSIZE=1000000
SAVEHIST=1000000
HISTORY_IGNORE='(:|true|false|pwd|which *|type *|where *|exit|(|z)man(| *)|less *|bat *|neofetch(| *)|*--help|*--version)'
setopt EXTENDED_HISTORY
setopt SHARE_HISTORY
setopt HIST_REDUCE_BLANKS
setopt HIST_IGNORE_SPACE
setopt HIST_FIND_NO_DUPS

# zle
dot-widgetinit
zle -N accept-line-with-expand-alias
zle -N self-insert-with-expand-alias
zle -N history-beginning-search-forward-end history-search-end
zle -N history-beginning-search-backward-end history-search-end
zle -N insert-last-word smart-insert-last-word
zstyle ':insert-last-word' match '*([[:alpha:]/\\]?|?[[:alpha:]/\\])*'

# keybindings
bindkey '^N' history-beginning-search-forward-end
bindkey '^P' history-beginning-search-backward-end
bindkey '^[[Z' reverse-menu-complete
bindkey '^M' accept-line-with-expand-alias
bindkey ' ' self-insert-with-expand-alias
bindkey '^R' dot-put-history
bindkey '^X^B' dot-insert-git-branch
bindkey '^X^F' dot-insert-git-file
bindkey '^X^G' dot-cd-ghq
bindkey '^X^J' dot-cd-zoxide

# setup cli tools
source $ZDOTDIR/fzf.config.zsh
dot-evalcache navi widget zsh
dot-evalcache zoxide init zsh --no-cmd
dot-evalcache direnv hook zsh

# plugins
dot-evalcache sheldon source

# prompt
promptinit
prompt zen

autoload -Uz compinit
autoload -Uz select-word-style
autoload -Uz dot-evalcache
autoload -Uz dot-widget-init

# core
setopt no_flow_control
setopt print_eight_bit

# prompt
setopt transient_rprompt

# aliases
alias ..='cd ..'
alias t='cd "$(mktemp -d)"'
alias st='git status'
alias ck='git checkout'
alias br='git branch -vv'
alias co='git commit'
alias di='git -c delta.side-by-side=true diff'
alias gg='git graph -n 15'
alias c='chezmoi'
alias m='multipass'
alias ls='exa -gF --icons --git --color=always -la'
alias grep='rg'
alias find='fd'
alias top='btm'
alias htop='btm'
alias df='duf'
alias du='dust'
alias ping='gping'

# word-chars
select-word-style default
zstyle ':zle:*' word-chars " /=;@:{},|"
zstyle ':zle:*' word-style unspecified

# completions
setopt list_packed
setopt nolistbeep
setopt list_rows_first
setopt magic_equal_subst
zstyle ':completion:*' matcher-list '' 'm:{a-z}={A-Z} r:|[-_.]=**' '+m:{A-Z}={a-z} r:|[-_.]=**'
zstyle ':completion:*:default' menu select=2
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.cache/zsh/compcache

# histories
setopt extendedhistory
setopt share_history
setopt hist_reduce_blanks
setopt hist_find_no_dups

# keybindings
bindkey '^N' history-search-forward
bindkey '^P' history-search-backward
bindkey '^[[Z' reverse-menu-complete
bindkey '^M' dot-expand-alias-and-accept-line
bindkey ' ' dot-expand-alias-and-self-insert
bindkey '^R' dot-put-history
bindkey '^X^B' dot-insert-git-branch
bindkey '^X^F' dot-insert-git-file
bindkey '^X^G' dot-cd-ghq
bindkey '^X^J' dot-cd-zoxide

dot-evalcache sheldon source
dot-evalcache starship init zsh --print-full-init

zsh-defer dot-evalcache navi widget zsh
zsh-defer dot-evalcache zoxide init zsh --no-cmd
zsh-defer dot-evalcache direnv hook zsh

zsh-defer dot-widget-init
zsh-defer -c 'export LS_COLORS="$(vivid generate iceberg-dark)"'
zsh-defer -c 'zstyle ":completion:*" list-colors ${(s.:.)LS_COLORS}'
zsh-defer source ~/.config/fzf/config.sh

zsh-defer compinit -C -d ~/.cache/zsh/compdump
